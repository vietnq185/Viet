{"version":3,"sources":["server/controllers/user.controller.js"],"names":["authCtrl","debug","require","load","req","res","next","id","verifyAccessToken","err","where","findOne","then","user","NOT_FOUND","hashedPassword","finalResp","uModel","urModel","reset","findAll","_id","urResults","select","join","getTable","getDataPair","lsResults","i","length","urid","ls","extractData","linkedStudents","userRoleId","targetUserInfo","push","roles","catch","e","get","jwtInfo","getJwtInfo","isUser","userId","FORBIDDEN","json","create","uuid","email","body","username","validateEmail","findCount","cnt","errors","emailRegisted","OK","Promise","resolve","reject","validateUsername","usernameRegisted","promises","reqStatus","status","parentId","isNotEmptyArray","indexOf","validateParent","parentData","wrongUsername","all","results","salt","getSalt","data","phone","firstName","lastName","encrypt","password","provider","dateCreated","Date","getTime","role","isNotEmptyObject","metadata","insert","savedUser","registerError","parentUserData","userRoleData","targetModel","targetRef","update","userData","copy","optionalParams","param","list","query","limit","offset","users","remove","delete","deletedUser","cclist","orderBy","cc","flist","j","fn","aesDecrypt","ccSecret","replace","ex"],"mappings":"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","file":"user.controller.js","sourceRoot":"../../../../.."}